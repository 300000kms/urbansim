

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>Examples &mdash; urbansim 0.2dev documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  

  

  
        <link rel="index" title="Index"
              href="genindex.html"/>
        <link rel="search" title="Search" href="search.html"/>
    <link rel="top" title="urbansim 0.2dev documentation" href="index.html"/>
        <link rel="next" title="Core Models" href="models/index.html"/>
        <link rel="prev" title="Getting Started" href="gettingstarted.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          

          
            <a href="index.html" class="icon icon-home"> urbansim
          

          
          </a>

          
            
            
              <div class="version">
                0.2dev
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
                <ul class="current">
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Examples</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#basic-example-residential-price-hedonic">Basic Example - Residential Price Hedonic</a></li>
<li class="toctree-l2"><a class="reference internal" href="#complete-example-san-francisco-urbansim-modules">Complete Example - San Francisco UrbanSim Modules</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#table-sources">Table Sources</a></li>
<li class="toctree-l3"><a class="reference internal" href="#assumptions">Assumptions</a></li>
<li class="toctree-l3"><a class="reference internal" href="#variables">Variables</a></li>
<li class="toctree-l3"><a class="reference internal" href="#models">Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#model-configuration">Model Configuration</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#complete-example-san-francisco-urbansim-workflows">Complete Example - San Francisco UrbanSim Workflows</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#estimation-workflow">Estimation Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#simulation-workflow">Simulation Workflow</a></li>
<li class="toctree-l3"><a class="reference internal" href="#exploration-workflow">Exploration Workflow</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#model-implementation-choices">Model Implementation Choices</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#geographic-detail">Geographic Detail</a></li>
<li class="toctree-l3"><a class="reference internal" href="#urbanaccess-or-zones">UrbanAccess or Zones</a></li>
<li class="toctree-l3"><a class="reference internal" href="#jobs-or-establishments">Jobs or Establishments</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configuration-of-models">Configuration of Models</a></li>
<li class="toctree-l3"><a class="reference internal" href="#dealing-with-nans">Dealing with NaNs</a></li>
</ul>
</li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="models/index.html">Core Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="developer/index.html">Real Estate Development Models</a></li>
<li class="toctree-l1"><a class="reference internal" href="utils/index.html">UrbanSim Utilities</a></li>
<li class="toctree-l1"><a class="reference internal" href="maps/index.html">DataFrame Explorer</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="index.html">urbansim</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          

 



<div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="index.html">Docs</a> &raquo;</li>
      
    <li>Examples</li>
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="_sources/examples.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="examples">
<h1>Examples<a class="headerlink" href="#examples" title="Permalink to this headline">¶</a></h1>
<div class="section" id="basic-example-residential-price-hedonic">
<h2>Basic Example - Residential Price Hedonic<a class="headerlink" href="#basic-example-residential-price-hedonic" title="Permalink to this headline">¶</a></h2>
<p>A fairly complete case study of using UrbanSim can be shown entirely within a single IPython Notebook, as is the case with <a class="reference external" href="http://nbviewer.ipython.org/github/udst/sanfran_urbansim/blob/6539736cbc9dbe5bbe4e2cd4559168308d46ded0/Hedonic%20Example.ipynb">this Notebook</a> from the <a class="reference external" href="https://github.com/udst/sanfran_urbansim">example repository</a>.</p>
<p>As the canonical example of using UrbanSim, take the case of a residential sales hedonic model used to perform an ordinary least squares regression on a table of building price data. The best practice would be to store the building data in a Pandas HDFStore, and the buildings table can include millions of rows (all of the buildings in a region) and attributes like square footage, lot size, number of bedrooms and bathrooms and the like. Importantly, the dependent variable should also be included which in this case might be the assessed or observed price of each unit.  The example repository includes sample data so that this Notebook can be executed.</p>
<p>This Notebook performs the exact same residential price hedonic as in the complete example below, but all entirely within the same IPython Notebook (and without explicitly using the <code class="docutils literal"><span class="pre">sim.model</span></code> decorator).  The simplest use case of the UrbanSim methodology is to create a single model to study an emperical behavior of interest to the modeler, and a good place to start in building such a model is this example.</p>
<p>Note that the flow of the notebook is one often followed in statistical modeling:</p>
<ul class="simple">
<li>Import the necessary modules</li>
<li>Set the data repository (HDFStore)</li>
<li>Name the actual tables from the repository (and set a relationship between zones and buildings)</li>
<li>Set all columns which are computed from the source data - for instance, map specific <code class="docutils literal"><span class="pre">building_type_ids</span></code> to a <code class="docutils literal"><span class="pre">general_type</span></code> column or sum the number of residential units in a zone using the <code class="docutils literal"><span class="pre">sum_residential_units</span></code> variable and so forth.  Note that the vast majority of code in this notebook is in creating computed columns</li>
<li>Next instantiate and configure the RegressionModel instance for the hedonic, including some filters which get rid of degenerate data</li>
<li>Then merge the buildings and zones tables and fill invalid numeric values with reasonable imputations (medians, modes, or zeros respectively)</li>
<li>Then fit the model and print the fit summary</li>
<li>And finally run the model in predict mode and describe the predicted values</li>
</ul>
<p>If you can follow this simple functionality, most of UrbanSim simply repeats this sort of flow for other urban behaviors.  It&#8217;s probably a good idea to read through this example a few times until it&#8217;s relatively clear how the parts fit together before moving on to the complete example. For the complete example, a process like the one described above is then repeated for each model of urban behavior described in the <a class="reference external" href="gettingstarted.html#a-gentle-introduction-to-urbansim">gentle introduction to UrbanSim</a>.</p>
<p>Note that there is often some overlap in data needs for different models - for instance, both the residential and non-residential hedonic models in the implementation below use the same buildings table to compute the relevant variables (although the variables that are utilized are often slightly different).  Thus it is usually good practice to abstract bits of functionality into different parts of the model system to aid in code reuse.  A full example follows which shows exactly how this can be done.</p>
</div>
<div class="section" id="complete-example-san-francisco-urbansim-modules">
<h2>Complete Example - San Francisco UrbanSim Modules<a class="headerlink" href="#complete-example-san-francisco-urbansim-modules" title="Permalink to this headline">¶</a></h2>
<p>A complete example of the latest UrbanSim framework is now being maintained on <a class="reference external" href="https://github.com/udst/sanfran_urbansim">GitHub</a>.  The example requires that the UrbanSim package is already installed (no other dependencies are required).  The example is maintained under <a class="reference external" href="https://travis-ci.org/udst/sanfran_urbansim">Travis Continuous Integration</a> so should always run with the latest version of UrbanSim.</p>
<p>The example has a number of Python modules including <code class="docutils literal"><span class="pre">dataset.py</span></code>, <code class="docutils literal"><span class="pre">assumptions.py</span></code>, <code class="docutils literal"><span class="pre">variables.py</span></code>, <code class="docutils literal"><span class="pre">models.py</span></code> which will be discussed one at a time below.  The modules are then used in <em>workflows</em> which are IPython Notebooks and will be described in detail in the following section.</p>
<div class="section" id="table-sources">
<h3>Table Sources<a class="headerlink" href="#table-sources" title="Permalink to this headline">¶</a></h3>
<p>Table sources are a decorator that describes from where UrbanSim data comes.  All table sources return <a class="reference external" href="http://pandas.pydata.org/pandas-docs/dev/generated/pandas.DataFrame.html">Pandas DataFrames</a> but the data can come from different locations, including HDF5 files, CSV files, databases, Excel files, and others.  Pandas has a large and ever-expanding set of <a class="reference external" href="http://pandas.pydata.org/pandas-docs/dev/io.html">data connectivity modules</a> although this example keeps data in a single HDF5 data store which is <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/master/data">provided directly in the repo</a>.</p>
<p>Specifying a source of data for a dataframe is done with the <a class="reference external" href="sim/index.html#urbansim.sim.simulation.table_source">table_source</a> decorator as in the code below, which is lifted <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/dataset.py#L26">directly from the example</a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@sim</span><span class="o">.</span><span class="n">table_source</span><span class="p">(</span><span class="s1">&#39;households&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">households</span><span class="p">(</span><span class="n">store</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">store</span><span class="p">[</span><span class="s1">&#39;households&#39;</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span>
</pre></div>
</div>
<p>The complete example includes mappings of tables stored in the HDF5 file to table sources for a typical UrbanSim schema, including parcels, buildings, households, jobs, zoning (density limits and allowable uses), and zones (aggregate geographic shapes in the city).  By convention these table sources are stored in the <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/dataset.py">dataset.py</a> file but this is not a strict requirement.</p>
<p>Arbitrary Python can occur in these table sources as shown in the <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/dataset.py#L69">zoning_baseline table source</a> which uses injections of <code class="docutils literal"><span class="pre">zoning</span></code> and <code class="docutils literal"><span class="pre">zoning_for_parcels</span></code> that were defined in the prior lines of code.</p>
<p>Finally, the relationships between all tables can be specified with the <a class="reference external" href="sim/index.html#urbansim.sim.simulation.broadcast">sim.broadcast decorator</a> and all of the broadcasts for the example are specified together at the <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/dataset.py#L78">bottom of the dataset.py file</a>.  Once these relationships are set they can be used later in the simulation using the <a class="reference external" href="sim/index.html#urbansim.sim.simulation.merge_tables">merge_tables helper</a>.</p>
</div>
<div class="section" id="assumptions">
<h3>Assumptions<a class="headerlink" href="#assumptions" title="Permalink to this headline">¶</a></h3>
<p>By convention <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/assumptions.py">assumptions.py</a> contains all of the high-level assumptions for the simulation. A typical assumption would be the <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/assumptions.py#L28">one below</a>, which sets a Python dictionary that can be used to map building types to land use category names.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="c1"># this maps building type ids to general building types</span>
<span class="c1"># basically just reduces dimensionality</span>
<span class="n">sim</span><span class="o">.</span><span class="n">add_injectable</span><span class="p">(</span><span class="s2">&quot;building_type_map&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="mi">1</span><span class="p">:</span> <span class="s2">&quot;Residential&quot;</span><span class="p">,</span>
    <span class="mi">2</span><span class="p">:</span> <span class="s2">&quot;Residential&quot;</span><span class="p">,</span>
    <span class="mi">3</span><span class="p">:</span> <span class="s2">&quot;Residential&quot;</span><span class="p">,</span>
    <span class="mi">4</span><span class="p">:</span> <span class="s2">&quot;Office&quot;</span><span class="p">,</span>
    <span class="mi">5</span><span class="p">:</span> <span class="s2">&quot;Hotel&quot;</span><span class="p">,</span>
    <span class="mi">6</span><span class="p">:</span> <span class="s2">&quot;School&quot;</span><span class="p">,</span>
    <span class="mi">7</span><span class="p">:</span> <span class="s2">&quot;Industrial&quot;</span><span class="p">,</span>
    <span class="mi">8</span><span class="p">:</span> <span class="s2">&quot;Industrial&quot;</span><span class="p">,</span>
    <span class="mi">9</span><span class="p">:</span> <span class="s2">&quot;Industrial&quot;</span><span class="p">,</span>
    <span class="mi">10</span><span class="p">:</span> <span class="s2">&quot;Retail&quot;</span><span class="p">,</span>
    <span class="mi">11</span><span class="p">:</span> <span class="s2">&quot;Retail&quot;</span><span class="p">,</span>
    <span class="mi">12</span><span class="p">:</span> <span class="s2">&quot;Residential&quot;</span><span class="p">,</span>
    <span class="mi">13</span><span class="p">:</span> <span class="s2">&quot;Retail&quot;</span><span class="p">,</span>
    <span class="mi">14</span><span class="p">:</span> <span class="s2">&quot;Office&quot;</span>
<span class="p">})</span>
</pre></div>
</div>
<p>All assumptions are registered with the simulation with the <a class="reference external" href="file:///Users/ffoti/src/urbansim/docs/_build/html/sim/index.html#urbansim.sim.simulation.add_injectable">add_injectable</a> method, which is used to register Python data types with names that can be injected to other simulation methods.  Although not all injectables are assumptions, this file mostly contains high-level assumptions including a <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/assumptions.py#L7">dictionary of building square feet per job for each building type</a>, <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/assumptions.py#L52">a map of building forms to building types</a>, etc.</p>
<p>Note that the above code simply sets the map to the name <code class="docutils literal"><span class="pre">building_type_map</span></code> - it must be injected and used somewhere else to have an effect.  In fact, this map is used in <code class="docutils literal"><span class="pre">variables.py</span></code> to compute the <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/variables.py#L125">general_type</a> attribute on the <code class="docutils literal"><span class="pre">buildings</span></code> table.</p>
<p>Perhaps most importantly, the <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/assumptions.py#L62">location of the HDFStore</a> is set using the <code class="docutils literal"><span class="pre">store</span></code> injectable.  An observant reader will notice that this <code class="docutils literal"><span class="pre">store</span></code> injectable which is set here was used in the table_source described above.  Note that the <code class="docutils literal"><span class="pre">store</span></code> injectable could be defined <em>after</em> the <code class="docutils literal"><span class="pre">households</span></code> <code class="docutils literal"><span class="pre">table_source</span></code> as long as they&#8217;re both registered before the simulation makes an attempt to call the registered methods.</p>
</div>
<div class="section" id="variables">
<h3>Variables<a class="headerlink" href="#variables" title="Permalink to this headline">¶</a></h3>
<p><a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/variables.py">variables.py</a> is similar to the <a class="reference external" href="http://www.urbansim.org/downloads/manual/dev-version/opus-userguide/node211.html">variable library</a> from the OPUS version of UrbanSim.  By convention all variables which are computed from underlying attributes are stored in this file.  Although the previous version of UrbanSim used a domain-specific <em>expression language</em>, the current version uses native Pandas, along with the <code class="docutils literal"><span class="pre">&#64;sim.column</span></code> decorator and dependency injection.  As before, the convention is to name the underlying data the <em>primary attributes</em> and the functions specified here as <em>computed columns</em>.  A typical example is shown below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@sim</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;zones&#39;</span><span class="p">,</span> <span class="s1">&#39;sum_residential_units&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">sum_residential_units</span><span class="p">(</span><span class="n">buildings</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">buildings</span><span class="o">.</span><span class="n">residential_units</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">buildings</span><span class="o">.</span><span class="n">zone_id</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<p>This creates a new column <code class="docutils literal"><span class="pre">sum_residential_units</span></code> for the <code class="docutils literal"><span class="pre">zones</span></code> table.  Notice that because of the magic of <code class="docutils literal"><span class="pre">groupby</span></code>, the grouping column is used as the index after the operation so although <code class="docutils literal"><span class="pre">buildings</span></code> has been passed in here, because <code class="docutils literal"><span class="pre">zone_id</span></code> is available on the <code class="docutils literal"><span class="pre">buildings</span></code> table, the Series that is returned is appropriate as a column on the <code class="docutils literal"><span class="pre">zones</span></code> table.  In other words <code class="docutils literal"><span class="pre">groupby</span></code> is used to <em>aggregate</em> from the buildings table to the zones table, which is a very common operation.</p>
<p>To move an attribute from one table to another using a foreign key, the <code class="docutils literal"><span class="pre">misc</span></code> module has a <a class="reference external" href="utils/misc.html#urbansim.utils.misc.reindex">reindex method</a>.  Thus even though <code class="docutils literal"><span class="pre">zone_id</span></code> is <em>only</em> a primary attribute on the <code class="docutils literal"><span class="pre">parcels</span></code> table, it can be moved using <code class="docutils literal"><span class="pre">reindex</span></code> to the <code class="docutils literal"><span class="pre">buildings</span></code> table using the <code class="docutils literal"><span class="pre">parcel_id</span></code> (foreign key) of that table.  This is shown below and extracted <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/variables.py#L122">from the example</a>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@sim</span><span class="o">.</span><span class="n">column</span><span class="p">(</span><span class="s1">&#39;buildings&#39;</span><span class="p">,</span> <span class="s1">&#39;zone_id&#39;</span><span class="p">,</span> <span class="n">cache</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">zone_id</span><span class="p">(</span><span class="n">buildings</span><span class="p">,</span> <span class="n">parcels</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">misc</span><span class="o">.</span><span class="n">reindex</span><span class="p">(</span><span class="n">parcels</span><span class="o">.</span><span class="n">zone_id</span><span class="p">,</span> <span class="n">buildings</span><span class="o">.</span><span class="n">parcel_id</span><span class="p">)</span>
</pre></div>
</div>
<p>Note that computed columns can also be used in other computed columns.  For instance <code class="docutils literal"><span class="pre">buildings.zone_id</span></code> in the code for the <code class="docutils literal"><span class="pre">sum_residential_units</span></code> columns is itself a computed column (defined by the code we just saw).</p>
<p><em>This is the real power of the framework.  The decorators define a hierarchy of dependent columns, which are dependent on other dependent columns, which are themselves dependent on primary attributes, which are likely dependent on injectables and table_sources.  In fact, the models we see next are usually what actually resolves these dependencies, and no variables are computed unless they are actually required by the models.  The user is relatively agnostic to this whole process and need only define a line or two of code at a time attached to the proper data concept.  Thus a whole data processing workflow can be built from the hierarchy of concepts within the simulation framework.</em></p>
<p><strong>A Note on Table Wrappers</strong></p>
<p>The <code class="docutils literal"><span class="pre">buildings</span></code> object that gets passed in is a <a class="reference external" href="sim/index.html#table-wrappers">Table Wrapper</a> and the reader is referred to the API documentation to learn more about this concept.  In general, this means the user has access to the Series object by name on the wrapper but the <strong>full set of Pandas DataFrame methods is not necessarily available.</strong>  For instance <code class="docutils literal"><span class="pre">.loc</span></code> and <code class="docutils literal"><span class="pre">.groupby</span></code> will both yield exceptions on the <code class="docutils literal"><span class="pre">Table</span> <span class="pre">Wrapper</span></code>.</p>
<p>To convert a <code class="docutils literal"><span class="pre">Table</span> <span class="pre">Wrapper</span></code> to a DataFrame, the user can simply call <a class="reference external" href="sim/index.html#urbansim.sim.simulation.DataFrameWrapper.to_frame">to_frame</a> but this returns <em>all</em> computed columns on the table and so has performance implications.  In general it&#8217;s better to use the Series objects directly where possible.</p>
<p>As a concrete example, the following code is recommended:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">buildings</span><span class="o">.</span><span class="n">residential_units</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="n">buildings</span><span class="o">.</span><span class="n">zone_id</span><span class="p">)</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<p>This will <em>not</em> work:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">buildings</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;zone_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">residential_units</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<p>This <em>will</em> work but is <em>slow</em>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">buildings</span><span class="o">.</span><span class="n">to_frame</span><span class="p">()</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;zone_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">residential_units</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<p>One workaround is to call <code class="docutils literal"><span class="pre">to_frame</span></code> with only the columns you need, although this is a verbose syntax, i.e. this <em>will</em> work but is <em>syntactically awkward</em>.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">buildings</span><span class="o">.</span><span class="n">to_frame</span><span class="p">([</span><span class="s1">&#39;zone_id&#39;</span><span class="p">,</span> <span class="s1">&#39;residential_units&#39;</span><span class="p">])</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;zone_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">residential_units</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
<p>Finally, if all the attributes being used are primary, the user can call <code class="docutils literal"><span class="pre">local_columns</span></code> without serious performance degradation.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="k">return</span> <span class="n">buildings</span><span class="o">.</span><span class="n">to_frame</span><span class="p">(</span><span class="n">buildings</span><span class="o">.</span><span class="n">local_columns</span><span class="p">)</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;zone_id&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">residential_units</span><span class="o">.</span><span class="n">sum</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="section" id="models">
<h3>Models<a class="headerlink" href="#models" title="Permalink to this headline">¶</a></h3>
<p>The main objective of the <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/models.py">models.py</a> file is to define the &#8220;entry points&#8221; into the model system. Although UrbanSim provides the direct API for a <a class="reference external" href="models/statistical.html#urbansim.models.regression.RegressionModel">Regression Model</a>, a <a class="reference external" href="models/statistical.html#urbansim.models.lcm.MNLLocationChoiceModel">Location Choice Model</a>, etc, it is the models.py file which defines the specific <em>steps</em> that outline a simulation or even a more general data processing workflow.</p>
<p>In the San Francisco example, there are two price/rent <a class="reference external" href="http://en.wikipedia.org/wiki/Hedonic_regression">hedonic models</a> which both use the RegressionModel, one which is the residential sales hedonic which is estimated with the entry point <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/models.py#L9">rsh_estimate</a> and then run in simulation mode with the entry point rsh_simulate.  The non-residential rent hedonic has similar entry points <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/models.py#L20">nrh_estimate</a> and nrh_simulate.  Note that both functions call <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/master/utils.py#L110">hedonic_estimate</a> and hedonic_simulate in <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/utils.py">utils.py</a>.  In this case <code class="docutils literal"><span class="pre">utils.py</span></code> actually uses the UrbanSim API by calling the <a class="reference external" href="models/statistical.html#urbansim.models.regression.RegressionModel.fit_from_cfg">fit_from_cfg</a> method on the Regressionmodel.</p>
<p>There are two things that warrant further explanation at this point.</p>
<ul>
<li><p class="first"><code class="docutils literal"><span class="pre">utils.py</span></code> is a set of helper functions that assist with merging data and running models from configuration files.  Note that the code in this file is generally shareable across UrbanSim implementations (in fact, this exact code is in use in multiple live simulations).  It defines a certain style of UrbanSim and handles a number of boundary cases in a transparent way.  In the long run, this kind of functionality might be unit tested and moved to UrbanSim, but for now we think it helps with transparency, flexibility, and debugging to keep this file with the specific client implementations.</p>
</li>
<li><p class="first">Many of the models use configuration files to define the actual model configuration.  In fact, most models in this file are very short <em>stub</em> functions which pass a Pandas DataFrame into the estimation and configure the model using a configuration file in the <a class="reference external" href="http://en.wikipedia.org/wiki/YAML">YAML file format</a>. For instance, the <code class="docutils literal"><span class="pre">rsh_estimate</span></code> function knows to read the configuration file, estimate the model defined in the configuration on the dataframe passed in, and write the estimated coefficients back to the same configuration file, and the complete method is pasted below:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@sim</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;rsh_estimate&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rsh_estimate</span><span class="p">(</span><span class="n">buildings</span><span class="p">,</span> <span class="n">zones</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">hedonic_estimate</span><span class="p">(</span><span class="s2">&quot;rsh.yaml&quot;</span><span class="p">,</span> <span class="n">buildings</span><span class="p">,</span> <span class="n">zones</span><span class="p">)</span>
</pre></div>
</div>
</li>
</ul>
<blockquote>
<div><p>For simulation, the stub is only slightly more complicated - in this case the model is simulating an output based on the model we estimated above, and the resulting Pandas <code class="docutils literal"><span class="pre">Series</span></code> needs to be stored on an UrbanSim table with a given attribute name (in this case to the <code class="docutils literal"><span class="pre">residential_sales_price</span></code> attribute of buildings table).:</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="nd">@sim</span><span class="o">.</span><span class="n">model</span><span class="p">(</span><span class="s1">&#39;rsh_simulate&#39;</span><span class="p">)</span>
<span class="k">def</span> <span class="nf">rsh_simulate</span><span class="p">(</span><span class="n">buildings</span><span class="p">,</span> <span class="n">zones</span><span class="p">):</span>
    <span class="k">return</span> <span class="n">utils</span><span class="o">.</span><span class="n">hedonic_simulate</span><span class="p">(</span><span class="s2">&quot;rsh.yaml&quot;</span><span class="p">,</span> <span class="n">buildings</span><span class="p">,</span> <span class="n">zones</span><span class="p">,</span>
                              <span class="s2">&quot;residential_sales_price&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div></blockquote>
<p>These stubs can then be repeated as necessary with quite a bit of flexibility.  For instance, the live Bay Area UrbanSim implementation has an additional hedonic model for residential rent which is not present in the example, and the associated stubs make use of a new configuration file called <code class="docutils literal"><span class="pre">rrh.yaml</span></code> and so forth.</p>
<p>A typical UrbanSim models setup is present in the <code class="docutils literal"><span class="pre">models.py</span></code> file, which registers 15 models including hedonic models, location choice models, relocation models, and transition models for both the residential and non-residential sides of the real estate market, then a feasibility model which uses the prices simulated previously to measure real estate development feasibility, and a developer model for each of the residential and non-residential sides.</p>
<p>Note that some parameters are defined directly in Python while other models have full configuration files to specify the model configuration.  This is a matter of taste, and eventually all of the models are likely to be YAML configurable.</p>
<p>Note also that some models have dependencies on previous models.  For instance <code class="docutils literal"><span class="pre">hlcm_simulate</span></code> and <code class="docutils literal"><span class="pre">feasibility</span></code> are both dependent on <code class="docutils literal"><span class="pre">rsh_simulate</span></code>.  At this time there is no way to guarantee that model dependencies are met and this is left to the user to resolve.  For full simulations, there is a typical order of models which doesn&#8217;t change very often, so this requirement is not terribly onerous.</p>
<p>Clearly <code class="docutils literal"><span class="pre">models.py</span></code> is extremely flexible - any method which reads and writes data using the simulation framework can be considered a model. Models with more logic than the stubs above are common, although more complicated functionality should eventually be generalized, documented, unit tested, and added to UrbanSim.  In the future new travel modeling and data cleaning workflows will be implemented in the same framework.</p>
<p>One final point about <code class="docutils literal"><span class="pre">models.py</span></code> - these entry points are designed to be written by the model implementer and not necessarily the modeler herself.  Once the models have been correctly set up, the basic infrastructure of the model will rarely change.  What happens more frequently is 1) a new data source is added 2) a new variable is computed with a column from that data source and then 3) that variable is added to the YAML configuration for one of the statistical models. The framework is designed to enable these changes, and because of this <strong>models.py is the least frequent to change of the modules described here.  models.py defines the structure of the simulation while the other modules enable the configuration.</strong></p>
</div>
<div class="section" id="model-configuration">
<h3>Model Configuration<a class="headerlink" href="#model-configuration" title="Permalink to this headline">¶</a></h3>
<p>Bridging the divide between the modules above and the workflows below are the configuration files.  Note that models can be configured directly in Python code (as in the basic example) or in YAML configuration files (as in the complete example).  If using the <code class="docutils literal"><span class="pre">utils.py</span></code> methods above, the simulation is set up to read and write from the configuration files.</p>
<p>The example has <a class="reference external" href="https://github.com/udst/sanfran_urbansim/tree/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/configs">four configuration files</a> which can be navigated on the GitHub site.  The <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/configs/rsh.yaml">rsh.yaml</a> file has a mixture of input and output parameters and the complete set of input parameters is displayed below.</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">name</span><span class="p">:</span> <span class="n">rsh</span>

<span class="n">model_type</span><span class="p">:</span> <span class="n">regression</span>

<span class="n">fit_filters</span><span class="p">:</span>
<span class="o">-</span> <span class="n">unit_lot_size</span> <span class="o">&gt;</span> <span class="mi">0</span>
<span class="o">-</span> <span class="n">year_built</span> <span class="o">&gt;</span> <span class="mi">1000</span>
<span class="o">-</span> <span class="n">year_built</span> <span class="o">&lt;</span> <span class="mi">2020</span>
<span class="o">-</span> <span class="n">unit_sqft</span> <span class="o">&gt;</span> <span class="mi">100</span>
<span class="o">-</span> <span class="n">unit_sqft</span> <span class="o">&lt;</span> <span class="mi">20000</span>

<span class="n">predict_filters</span><span class="p">:</span>
<span class="o">-</span> <span class="n">general_type</span> <span class="o">==</span> <span class="s1">&#39;Residential&#39;</span>

<span class="n">model_expression</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">residential_sales_price</span><span class="p">)</span> <span class="o">~</span> <span class="n">I</span><span class="p">(</span><span class="n">year_built</span> <span class="o">&lt;</span> <span class="mi">1940</span><span class="p">)</span> <span class="o">+</span> <span class="n">I</span><span class="p">(</span><span class="n">year_built</span>
    <span class="o">&gt;</span> <span class="mi">2005</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">unit_sqft</span><span class="p">)</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">unit_lot_size</span><span class="p">)</span> <span class="o">+</span> <span class="n">sum_residential_units</span>
    <span class="o">+</span> <span class="n">ave_lot_sqft</span> <span class="o">+</span> <span class="n">ave_unit_sqft</span> <span class="o">+</span> <span class="n">ave_income</span>

<span class="n">ytransform</span><span class="p">:</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span>
</pre></div>
</div>
<p>Notice that the parameters <code class="docutils literal"><span class="pre">name</span></code>, <code class="docutils literal"><span class="pre">fit_filters</span></code>, <code class="docutils literal"><span class="pre">predict_filters</span></code>, <code class="docutils literal"><span class="pre">model_expression</span></code>, and <code class="docutils literal"><span class="pre">y_transform</span></code> are the exact same parameters provided to the <a class="reference external" href="models/statistical.html#urbansim.models.regression.RegressionModel">RegressionModel object</a> in the api. This is by design, so that the API documentation also documents the configuration files although an example configuration is a great place to get started while using the API pages as a reference.</p>
<p>YAML configuration files currently can also be used to define location choice models and even accessibility variables, and in theory can be added to any UrbanSim model that supports <a class="reference external" href="models/statistical.html#yaml-persistence">YAML persistence</a> as described in the API docs.  Using configuration files specified in YAML also allows interactivity with the <a class="reference external" href="https://github.com/udst/usui">UrbanSim web portal</a>, which is one of the main reasons for following this architecture.</p>
<p>As can be seen, these configuration files are a great way to separate specification of the model from the actual infrastructure that stores and uses these configuration files and the data which gets passed to the models, both of which are defined in the <code class="docutils literal"><span class="pre">models.py</span></code> file.  As stated before, <code class="docutils literal"><span class="pre">models.py</span></code> entry points define the structure of the simulation while the YAML files are used to configure the models.</p>
</div>
</div>
<div class="section" id="complete-example-san-francisco-urbansim-workflows">
<h2>Complete Example - San Francisco UrbanSim Workflows<a class="headerlink" href="#complete-example-san-francisco-urbansim-workflows" title="Permalink to this headline">¶</a></h2>
<p>Once the proper setup of Python modules is accomplished as above, interactive execution of certain UrbanSim workflows is extremely easy to accomplish, and will be described in the subsections below.  These are all done in the IPython Notebook and use nbviewer to display the results in a web browser.  We use IPython Notebooks (or the UrbanSim web portal) for almost any workflow in order to avoid executing Python from the command line / console, although this is an option as well.</p>
<p><em>Note that because these workflows are IPython Notebooks, the reader should browse to the example on the web and no example code will be pasted here.</em></p>
<p>One thing to note is the <a class="reference external" href="http://ipython.org/ipython-doc/dev/config/extensions/autoreload.html">autoreload magic</a> used in all of these workflows.  This can be very helpful when interactively editing code in the underlying Python modules as it automatically keeps the code in sync within the notebooks (i.e. it re-imports the modules when the underlying code changes).</p>
<div class="section" id="estimation-workflow">
<h3>Estimation Workflow<a class="headerlink" href="#estimation-workflow" title="Permalink to this headline">¶</a></h3>
<p>A sample estimation workflow is available <a class="reference external" href="http://nbviewer.ipython.org/github/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/Estimation.ipynb">in this Notebook</a>.</p>
<p>This notebook estimates all of the models in the example that need estimation (because they are statistical models).  In fact, every cell simply calls the <a class="reference external" href="sim/index.html#running-simulations">sim.run</a> method with one of the names of the model entry points defined in <code class="docutils literal"><span class="pre">models.py</span></code>. The <code class="docutils literal"><span class="pre">sim.run</span></code> method resolves all of the dependencies and prints the output of the model estimation in the result cell of the IPython Notebook.  Note that the hedonic models are estimated first, then simulated, and then the location choice models are estimated since the hedonic models are dependencies of the location choice models.  In other words, the <code class="docutils literal"><span class="pre">rsh_simulate</span></code> method is configured to create the <code class="docutils literal"><span class="pre">residential_sales_price</span></code> column which is then a right hand side variable in the <code class="docutils literal"><span class="pre">hlcm_estimate</span></code> model (because residential price is theorized to impact the location choices of households).</p>
</div>
<div class="section" id="simulation-workflow">
<h3>Simulation Workflow<a class="headerlink" href="#simulation-workflow" title="Permalink to this headline">¶</a></h3>
<p>A sample simulation workflow (a complete UrbanSim simulation) is available <a class="reference external" href="http://nbviewer.ipython.org/github/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/Simulation.ipynb">in this Notebook</a>.</p>
<p>This notebook is possibly even simpler than the estimation workflow as it has only one substantive cell which runs all of the available models in the appropriate sequence.  Passing a range of years will run the simulation for multiple years (the example simply runs the simulation for a single year).  Other parameters are available to the  <a class="reference external" href="sim/index.html#running-simulations">sim.run</a> method which write the output to an HDF5 file.</p>
</div>
<div class="section" id="exploration-workflow">
<span id="id2"></span><h3>Exploration Workflow<a class="headerlink" href="#exploration-workflow" title="Permalink to this headline">¶</a></h3>
<p>UrbanSim now also provides a method to interactively explore UrbanSim inputs and outputs using web mapping tools, and the <a class="reference external" href="http://nbviewer.ipython.org/github/udst/sanfran_urbansim/blob/462f1f9f7286ffbaf83ae5ad04775494bf4d1677/Exploration.ipynb">exploration notebook</a> demonstrates how to set up and use this interactive display tool.</p>
<p>This is another simple and powerful notebook which can be used to quickly map variables of both base year and simulated data without leaving the workflow to use GIS tools.  This example first creates the DataFrames for many of the UrbanSim tables that have been registered (<code class="docutils literal"><span class="pre">buildings</span></code>, <code class="docutils literal"><span class="pre">househlds</span></code>, <code class="docutils literal"><span class="pre">jobs</span></code>, and others).  Once the DataFrames have been created, they are passed to the <a class="reference external" href="maps/index.html#module-urbansim.maps.dframe_explorer">start</a> method.</p>
<p>See <a class="reference internal" href="maps/index.html#dframe-explorer"><span class="std std-ref">DataFrame Explorer</span></a> for detailed information on how to call the <code class="docutils literal"><span class="pre">start</span></code> method and what queries the website is performing.</p>
<p>Once the <code class="docutils literal"><span class="pre">start</span></code> method has been called, the IPython Notebook is running a web service which will respond to queries from a web browser.  Try it out - open your web browser and navigate to <a class="reference external" href="http://localhost:8765/">http://localhost:8765/</a> or follow the same link embedded in your notebook.  Note the link won&#8217;t work on the web example - you need to have the example running on your local machine - all queries are run interactively between your web browser and the IPython Notebook.  Your web browser should show a page like the following:</p>
<img alt="_images/dframe_explorer_screenshot.png" src="_images/dframe_explorer_screenshot.png" />
<p>See <a class="reference internal" href="maps/index.html#dframe-explorer-website"><span class="std std-ref">Website Description</span></a> for a description of how to use the website that is rendered.</p>
<p>Because the web service is serving these queries directly from the IPython Notebook, you can execute some part of a data processing workflow, then run <code class="docutils literal"><span class="pre">dframe_explorer</span></code> and look at the results.  If something needs modification, simply hit the <code class="docutils literal"><span class="pre">interrupt</span> <span class="pre">kernel</span></code> menu item in the IPython Notebook.  You can now execute more Notebook cells and return to <code class="docutils literal"><span class="pre">dframe_explorer</span></code> at any time by running the appropriate cell again.  Now map exploration is simply another interactive step in your data processing workflow.</p>
</div>
</div>
<div class="section" id="model-implementation-choices">
<h2>Model Implementation Choices<a class="headerlink" href="#model-implementation-choices" title="Permalink to this headline">¶</a></h2>
<p>There are a number of model implementation choices that can be made in
implementing an UrbanSim regional forecasting tool, and this will describe a
few of the possibilities.  There is definitely a set of best practices
though, so shoot us an email if you want more detail.</p>
<div class="section" id="geographic-detail">
<h3>Geographic Detail<a class="headerlink" href="#geographic-detail" title="Permalink to this headline">¶</a></h3>
<p>Although zone or block-level models can be done (and gridcells have been used
historically), at this point the geographic detail is typically at the parcel or
building level.  If good information is available for individual units,
this level or detail is actually ideal.</p>
<p>Most household and employment location choices choose building_ids at this
point, and the number of available units is measured as the supply of
units / job_spaces in the building minus the number of households / jobs in the
building.</p>
</div>
<div class="section" id="urbanaccess-or-zones">
<h3>UrbanAccess or Zones<a class="headerlink" href="#urbanaccess-or-zones" title="Permalink to this headline">¶</a></h3>
<p>It is fairly standard to combine the buildings from the locations discussed
above with some measure of the neighborhood around each building.  The simplest
implementation of this idea is used in the sanfran_example - and is typical of
traditional GIS - which is to use aggregations within some higher level polygon.
In the most common case, the region has zones assigned and every parcel is
assigned a <code class="docutils literal"><span class="pre">zone_id</span></code> (the <code class="docutils literal"><span class="pre">zone_id</span></code> is then available on the other related
tables).  Once <code class="docutils literal"><span class="pre">zone_ids</span></code> are available, vanilla Pandas is usable and GIS
is not strictly required.</p>
<p>Although this is the easiest implementation method, a pedestrian-scale
network-based method is perhaps more appropriate when analyses are happening
at the parcel- and building-scale and this is the exactly the intended purpose
of the <a class="reference external" href="https://github.com/udst/pandana">Pandana</a> framework.
Most full UrbanSim implementations now use aggregations along the local street
network, and <code class="docutils literal"><span class="pre">Pandana</span></code> will be released as an official product by the
end of 2014.</p>
</div>
<div class="section" id="jobs-or-establishments">
<h3>Jobs or Establishments<a class="headerlink" href="#jobs-or-establishments" title="Permalink to this headline">¶</a></h3>
<p>Jobs by sector is often the unit of analysis for the non-residential side,
as this kind of model is completely analagous to the residential side and is
perhaps the easiest to understand.  In some cases establishments can be used
instead of jobs to capture different behavior of different size
establishments, but fitting establishments into buildings then becomes a
tricky endeavor (and modeling the movements of large employers should not
really be part of the scope of the model system).</p>
</div>
<div class="section" id="configuration-of-models">
<h3>Configuration of Models<a class="headerlink" href="#configuration-of-models" title="Permalink to this headline">¶</a></h3>
<p>Some choices need to made on the configuration of models.  For instance,
is there a single hedonic for residential sales price or is there a second
model for rent?  Is  non-residential rent segmented by building type?  How many
different uses are there in the pro forma and what forms (mixes of uses) will be
tested. The simplest model configuration is shown in the sanfran_urbansim
example, and additional behavior can be captured to answer specific research
questions.</p>
</div>
<div class="section" id="dealing-with-nans">
<h3>Dealing with NaNs<a class="headerlink" href="#dealing-with-nans" title="Permalink to this headline">¶</a></h3>
<p>There is not a standard method for dealing with NaNs (typically indicating
missing data) within UrbanSim, but there is a good convention that can be
used.  First an injectable can be set with an object in this form (make sure
to set the name appropriately):</p>
<div class="highlight-default"><div class="highlight"><pre><span></span><span class="n">sim</span><span class="o">.</span><span class="n">add_injectable</span><span class="p">(</span><span class="s2">&quot;fillna_config&quot;</span><span class="p">,</span> <span class="p">{</span>
    <span class="s2">&quot;buildings&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;residential_sales_price&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">),</span>
        <span class="s2">&quot;non_residential_rent&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">),</span>
        <span class="s2">&quot;residential_units&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">),</span>
        <span class="s2">&quot;non_residential_sqft&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;zero&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">),</span>
        <span class="s2">&quot;year_built&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;median&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">),</span>
        <span class="s2">&quot;building_type_id&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;int&quot;</span><span class="p">)</span>
    <span class="p">},</span>
    <span class="s2">&quot;jobs&quot;</span><span class="p">:</span> <span class="p">{</span>
        <span class="s2">&quot;job_category&quot;</span><span class="p">:</span> <span class="p">(</span><span class="s2">&quot;mode&quot;</span><span class="p">,</span> <span class="s2">&quot;str&quot;</span><span class="p">),</span>
    <span class="p">}</span>
<span class="p">})</span>
</pre></div>
</div>
<p>The keys in this object are table names, the values are also a dictionary
where the keys are column names and the values are a tuple.  The first value
of the tuple is what to call the Pandas <code class="docutils literal"><span class="pre">fillna</span></code> function with,
and can be a choice of &#8220;zero,&#8221; &#8220;median,&#8221; or &#8220;mode&#8221; and should be set
appropriately by the user for the specific column.  The second argument is
the data type to convert to. The user can then call
<code class="docutils literal"><span class="pre">utils.fill_na_from_config</span></code> as in the <a class="reference external" href="https://github.com/udst/sanfran_urbansim/blob/98b308f795c73ffc36c420845f394cbe3322b11b/dataset.py#L22">example</a> with a DataFrame and table name and all NaNs will be filled. This
functionality will eventually be moved into UrbanSim.</p>
</div>
</div>
</div>


           </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="models/index.html" class="btn btn-neutral float-right" title="Core Models" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gettingstarted.html" class="btn btn-neutral" title="Getting Started" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2016, UrbanSim Inc..

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'0.2dev',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  
  
    <script type="text/javascript" src="_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>